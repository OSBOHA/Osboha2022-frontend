"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[6739],{13238:function(t,e,a){var i=a(24150);class s{constructor(){this.prefix="notifications"}async listUnreadNotification(){try{const t=await i.hi.get(`${this.prefix}/un-read`);return t.data.data}catch(t){return t}}async listAllNotification(t){try{const e=await i.hi.get(`${this.prefix}/list-all?page=${t}`);return e.data.data}catch(e){return e}}async markAsRead(t){try{const e=await i.hi.get(`${this.prefix}/mark-as-read/${t}`);return e.data.data}catch(e){return e}}async markAllAsRead(){try{const t=await i.hi.get(`${this.prefix}/mark-all-as-read`);return t.data.data}catch(t){return t}}}e["Z"]=new s},2933:function(t,e,a){var i=a(24150);class s{resolve_porfile_img(t,e,a){let s=t+"_"+e;const n=`${i.v2}/profile-image/${a}/${s}`;return n}}e["Z"]=new s},6739:function(t,e,a){a.r(e),a.d(e,{default:function(){return D}});var i=a(66252),s=a(3577);const n=t=>((0,i.dD)("data-v-4a3890d5"),t=t(),(0,i.Cn)(),t),o={class:"row",ref:"listContainer"},r={class:"col-sm-12"},l=n((()=>(0,i._)("h4",{class:"card-title"},"الاشعارات",-1))),d=n((()=>(0,i._)("i",{role:"button",class:"material-symbols-outlined align-middle"}," done ",-1))),c={class:"notification-list m-0 p-0"},u={class:"d-flex align-items-center justify-content-between"},f={class:"user-img img-fluid"},m=["src","title"],h=["src","title"],g={class:"w-100"},p={class:"d-flex justify-content-between"},_={class:"ms-3"},w={class:"d-flex align-items-center"},k=["onClick"];function v(t,e,a,n,v,y){const b=(0,i.up)("tooltip"),R=(0,i.up)("router-link"),A=(0,i.up)("iq-card");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[l,v.unRead?((0,i.wg)(),(0,i.iD)("span",{key:0,role:"button",class:"btn btn-primary mb-3",style:{direction:"rtl !important"},onClick:e[0]||(e[0]=t=>y.markAllAsRead())},[d,(0,i.Uk)(" تحديد قراءة الكل ")])):(0,i.kq)("",!0)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(v.notifications,((e,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"col-sm-12",key:a},[(0,i.Wm)(A,{class:(0,s.C_)(y.seenClass(e.read_at))},{body:(0,i.w5)((()=>[(0,i._)("div",c,[(0,i._)("div",u,[(0,i._)("div",f,[e.data.sender.user_profile.profile_picture?((0,i.wg)(),(0,i.iD)("img",{key:0,src:y.resolve_porfile_img("60x60",e.data.sender.user_profile.profile_picture,e.data.sender.user_profile.id),alt:"profile-img",class:"rounded-circle avatar-40",title:e.data.sender.name},null,8,m)):((0,i.wg)(),(0,i.iD)("img",{key:1,src:y.resolve_porfile_img("60x60","ananimous_"+e.data.sender.gender+".png","ananimous"),alt:"profile-img",title:e.data.sender.name,class:"rounded-circle avatar-40"},null,8,h))]),(0,i._)("div",g,[(0,i._)("div",p,[(0,i._)("div",_,[(0,i._)("h6",null,(0,s.zw)(e.data.message),1),(0,i.Wm)(b,{tag:"span",class:"text-muted small",tooltipPlacement:"bottom","data-bs-toggle":"tooltip",title:t.formatFullDate(e.created_at)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.formatDateToWritten(e.created_at)),1)])),_:2},1032,["title"])]),(0,i._)("div",w,[(0,i.Wm)(R,{class:"me-1",to:{name:v.notification_route[e.data.type],params:{user_id:1}}},{default:(0,i.w5)((()=>[(0,i.Uk)(" عرض ")])),_:2},1032,["to"]),e.read_at?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",{key:0,role:"button",class:"material-symbols-outlined md-18 me-3",onClick:t=>y.markAsRead(e.id)}," done ",8,k))])])])])])])),_:2},1032,["class"])])))),128))],512)}var y=a(8209),b=a(13238),R=a(2933),A={name:"Notification",created(){this.loadNotifications()},async mounted(){window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)},data(){return{notifications:[],notifications_route:[],notification_route:{friends_requests:"user.friendsRequests"},page:1,totalPages:1,loading:!1,pendingRequest:!1,hasMore:!0,unRead:!1}},computed:{hasMoreToLoad(){return this.page<=this.totalPages&&this.hasMore}},methods:{...y.Z,resolve_porfile_img(t,e,a){return R.Z.resolve_porfile_img(t,e,a)},async loadNotifications(){if(!this.pendingRequest){this.pendingRequest=!0,this.loading=!0;try{let t=await b.Z.listAllNotification(this.page);if(this.notifications=t.data,console.log(this.notifications),this.checkUnread(),this.totalPages=t.data?.last_page??1,this.page++,200===t.statusCode&&!t.data)return void(this.hasMore=!1)}catch(t){console.log(t),y.Z.toggleToast("حدث خطأ أثناء تحميل المنشورات, حاول مرة أخرى","error")}finally{this.loading=!1,this.pendingRequest=!1}}},isAtBottomOfPage(){const t=this.$refs.listContainer.getBoundingClientRect(),e=t.bottom,a=window.innerHeight;return e<=a},handleScroll(){this.hasMoreToLoad&&this.isAtBottomOfPage()&&this.loadNotifications()},seenClass(t){return t?"seen":"un-seen"},async markAsRead(t){const e=await b.Z.markAsRead(t);this.notifications=e.data,this.checkUnread()},async markAllAsRead(){console.log("tet");const t=await b.Z.markAllAsRead();this.notifications=t.data,this.checkUnread()},checkUnread(){function t(t){return null===t.read_at}this.notifications.find(t)&&(this.unRead=!0)}}},C=a(83744);const x=(0,C.Z)(A,[["render",v],["__scopeId","data-v-4a3890d5"]]);var D=x}}]);
//# sourceMappingURL=6739.5afe9eb1.js.map