"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[1805],{13238:function(t,e,a){var i=a(66252),s=a(24150);class n{constructor(){this.prefix="notifications"}async listUnreadNotification(){try{const t=await s.hi.get(`${this.prefix}/un-read`);return t.data.data}catch(t){(0,i.S3)(t)}}async listAllNotification(t){try{const e=await s.hi.get(`${this.prefix}/list-all?page=${t}`);return e.data.data}catch(e){(0,i.S3)(e)}}async markAsRead(t){try{const e=await s.hi.get(`${this.prefix}/mark-as-read/${t}`);return e.data.data}catch(e){return e}}async markAllAsRead(){try{const t=await s.hi.get(`${this.prefix}/mark-all-as-read`);return t.data.data}catch(t){return t}}}e["Z"]=new n},2933:function(t,e,a){var i=a(24150);class s{resolve_porfile_img(t,e,a){let s=t+"_"+e;const n=`${i.v2}/profile-image/${a}/${s}`;return n}}e["Z"]=new s},53306:function(t,e,a){a.d(e,{Z:function(){return f}});var i=a(66252),s=a(3577);const n=["src","title"],r=["src","title"];function o(t,e,a,o,l,d){return(0,i.wg)(),(0,i.iD)("div",{class:(0,s.C_)(["user-img img-fluid",a.containerClass])},[a.profileImg?((0,i.wg)(),(0,i.iD)("img",{key:0,src:d.resolve_porfile_img(a.dimensions,a.profileImg,a.profile_id),alt:"profile-img",class:(0,s.C_)(["rounded-circle",a.avatarClass]),title:a.title,style:(0,s.j5)(a.imageStyle)},null,14,n)):((0,i.wg)(),(0,i.iD)("img",{key:1,src:d.resolve_porfile_img(a.dimensions,"ananimous_"+a.gender+".png","ananimous"),alt:"profile-img",title:a.title,class:(0,s.C_)(["rounded-circle",a.avatarClass]),style:(0,s.j5)(a.imageStyle)},null,14,r))],2)}var l=a(2933),d={name:"UserAvatar",props:{profileImg:{type:String,default:null},profile_id:{type:Number,default:null},dimensions:{type:String,default:"60x60"},title:{type:String,default:"user image"},avatarClass:{type:String,default:"avatar-40"},containerClass:{type:String,default:""},gender:{type:String,default:"male"},imageStyle:{type:Object,default:null}},methods:{resolve_porfile_img(t,e,a){return l.Z.resolve_porfile_img(t,e,a)}}},c=a(83744);const u=(0,c.Z)(d,[["render",o]]);var f=u},41805:function(t,e,a){a.r(e),a.d(e,{default:function(){return S}});var i=a(66252),s=a(3577),n=a(49963);const r=t=>((0,i.dD)("data-v-26b20c6f"),t=t(),(0,i.Cn)(),t),o={class:"row",ref:"listContainer"},l={class:"col-sm-12"},d=r((()=>(0,i._)("h4",{class:"card-title"},"الاشعارات",-1))),c=r((()=>(0,i._)("i",{role:"button",class:"material-symbols-outlined align-middle"}," done ",-1))),u={class:"notification-list m-0 p-0"},f={class:"d-flex align-items-center justify-content-between"},m={class:"w-100"},g={class:"d-flex justify-content-between"},h={class:"ms-3"},p={class:"d-flex align-items-center"},_=["onClick"],v=["onClick"];function y(t,e,a,r,y,k){const w=(0,i.up)("UserAvatar"),C=(0,i.up)("tooltip"),b=(0,i.up)("iq-card");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",l,[d,k.unreadCount>0?((0,i.wg)(),(0,i.iD)("span",{key:0,role:"button",class:"btn btn-primary mb-3",style:{direction:"rtl !important"},onClick:e[0]||(e[0]=t=>k.markAllAsRead())},[c,(0,i.Uk)(" تحديد قراءة الكل ")])):(0,i.kq)("",!0)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(y.notifications,((e,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"col-sm-12",key:a},[(0,i.Wm)(b,{class:(0,s.C_)(k.seenClass(e.read_at))},{body:(0,i.w5)((()=>[(0,i._)("div",u,[(0,i._)("div",f,[(0,i.Wm)(w,{profileImg:e.data.sender.user_profile.profile_picture,profile_id:e.data.sender.user_profile.id,title:e.data.sender.name,gender:e.data.sender.gender,avatarClass:"rounded-circle avatar-40"},null,8,["profileImg","profile_id","title","gender"]),(0,i._)("div",m,[(0,i._)("div",g,[(0,i._)("div",h,[(0,i._)("h6",null,(0,s.zw)(e.data.message),1),(0,i.Wm)(C,{tag:"span",class:"text-muted small",tooltipPlacement:"bottom","data-bs-toggle":"tooltip",title:t.formatFullDate(e.created_at)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.formatDateToWritten(e.created_at)),1)])),_:2},1032,["title"])]),(0,i._)("div",p,[(0,i._)("span",{role:"button",class:"me-1",onClick:(0,n.iM)((t=>k.sendToPage(e.data.path,e.id)),["prevent"])}," عرض ",8,_),e.read_at?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",{key:0,role:"button",class:"material-symbols-outlined md-18 me-3",onClick:t=>k.markAsRead(e.id)}," done ",8,v))])])])])])])),_:2},1032,["class"])])))),128))],512)}var k=a(8209),w=a(13238),C=a(53306),b={name:"Notification",components:{UserAvatar:C.Z},created(){this.loadNotifications()},async mounted(){window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)},data(){return{notifications:[],notifications_route:[],notification_route:{friends_requests:"user.friendsRequests"},page:1,totalPages:1,loading:!1,pendingRequest:!1,hasMore:!0,unRead:!1}},computed:{hasMoreToLoad(){return this.page<=this.totalPages&&this.hasMore},unreadCount(){return this.$store.state.unreadNotifications}},methods:{...k.Z,async loadNotifications(){if(!this.pendingRequest){this.pendingRequest=!0,this.loading=!0;try{let t=await w.Z.listAllNotification(this.page);if(this.notifications=t.data,console.log(this.notifications),this.checkUnread(),this.totalPages=t.data?.last_page??1,this.page++,200===t.statusCode&&!t.data)return void(this.hasMore=!1)}catch(t){console.log(t),k.Z.toggleToast("حدث خطأ أثناء تحميل الإشعارات, حاول مرة أخرى","error")}finally{this.loading=!1,this.pendingRequest=!1}}},isAtBottomOfPage(){const t=this.$refs.listContainer.getBoundingClientRect(),e=t.bottom,a=window.innerHeight;return e<=a},handleScroll(){this.hasMoreToLoad&&this.isAtBottomOfPage()&&this.loadNotifications()},seenClass(t){return t?"seen":"un-seen"},async markAsRead(t){const e=await w.Z.markAsRead(t);this.notifications=e.data,this.checkUnread(),this.unreadCount>0&&this.$store.commit("SET_UNREAD_NOTIFICATIONS",this.unreadCount-1)},async markAllAsRead(){console.log("tet");const t=await w.Z.markAllAsRead();this.notifications=t.data,this.checkUnread(),this.$store.commit("SET_UNREAD_NOTIFICATIONS",0)},checkUnread(){function t(t){return null===t.read_at}this.notifications.find(t)&&(this.unRead=!0)},sendToPage(t,e){t&&this.$router.push({path:t}),this.markAsRead(e)}}},A=a(83744);const R=(0,A.Z)(b,[["render",y],["__scopeId","data-v-26b20c6f"]]);var S=R}}]);
//# sourceMappingURL=1805.c9da9567.js.map