"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[5308],{34964:function(e,s,t){var i=t(24150),o=t(66252);class a{async create(e,s,t,o,a,r,h,n,l,d,c){let p=new FormData;p.append("name",e),p.append("writer",s),p.append("start_page",a),p.append("end_page",r),p.append("publisher",t),p.append("brief",o),p.append("link",h),p.append("type_id",c),p.append("section_id",n),p.append("level",d),p.append("image",l);try{const e=await i.hi.post("/books",p,{headers:{"Content-type":"multipart/form-data"}});return e.data}catch(m){return m}}async getAll(e){try{const s=await i.hi.get("books?page="+e);return s.data.data}catch(s){(0,o.S3)(s)}}async getById(e){try{const s=await i.hi.get(`/books/${e}`);return s.data}catch(s){(0,o.S3)(s)}}async deleteById(e){try{return await i.hi["delete"](`/books/${e}`)}catch(s){return s}}async getBooksByType(e){try{const s=await i.hi.get(`/books/type/${e}`);return s.data}catch(s){return s}}async getBooksByLevel(e,s){try{const t=await i.hi.post(`/books/level?page=${s}`,{level:e});return t.data.data}catch(t){return t}}async getBooksByName(e,s){try{const t=await i.hi.post(`/books/name?page=${s}`,{name:e});return t.data.data}catch(t){return console.log(t),""}}async getBooksByLanguage(e,s){try{const t=await i.hi.post(`/books/language?page=${s}`,{language:e});return t.data.data}catch(t){return console.log(t),""}}async getBooksBySection(e){try{const s=await i.hi.get(`/books/section/${e}`);return s.data}catch(s){return s}}async getRecentAddedBooks(){try{const e=await i.hi.get("/books/recent-added-books");return e.data.data}catch(e){return console.log(e),""}}async getMostReadableBooks(){try{const e=await i.hi.get("/books/most-readable-books");return e.data.data}catch(e){return console.log(e),""}}async getRandomBook(){try{const e=await i.hi.get("/books/random-book");return e.data.data}catch(e){return console.log(e),""}}async latestBooks(){try{const e=await i.hi.get("/books/latest");return e.data.data}catch(e){return console.log(e),""}}}s["Z"]=new a},76614:function(e,s,t){t.d(s,{Z:function(){return oe}});var i=t(66252),o=t(49963),a=t(3577);const r=e=>((0,i.dD)("data-v-42061fa3"),e=e(),(0,i.Cn)(),e),h={class:"d-flex align-items-center w-100 row"},n={class:"row"},l=r((()=>(0,i._)("div",{class:"form-group"},[(0,i._)("h5",{class:"form-label"},"نوع الأطروحة")],-1))),d={class:"form-group"},c=(0,i.uE)('<option value="" data-v-42061fa3>اختر نوع الأطروحة</option><option value="read" data-v-42061fa3>قراءة</option><option value="readAndWrite" data-v-42061fa3>كتابة أطروحة</option><option value="screenshots" data-v-42061fa3>اقتباسات</option><option value="screenshotsAndWrite" data-v-42061fa3>كتابة واقتباسات</option>',5),p=[c],m={key:0,class:"row mt-2"},g={class:"form-group"},u={key:1,class:"row"},y=r((()=>(0,i._)("span",{class:"material-symbols-outlined md-18"}," refresh ",-1))),v={class:"form-group col-6"},k=r((()=>(0,i._)("option",{value:""},"صفحة البداية",-1))),w=["value"],b={key:0,class:"help-block"},f={key:0,style:{color:"red"}},_={key:1,style:{color:"red"}},T={class:"form-group col-6"},F=r((()=>(0,i._)("option",{value:""},"صفحة النهاية",-1))),$=["value"],D={key:0,class:"help-block"},O={key:0,style:{color:"red"}},q={key:1,style:{color:"red"}},S={key:2,class:"form-group"},E=r((()=>(0,i._)("label",{class:"form-label",for:"thesisBody"},"الأطروحة",-1))),M={style:{direction:"rtl"}},B=r((()=>(0,i._)("span",null," - ",-1))),A={key:0,style:{color:"red"},class:"text-center"},I=r((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"error",-1))),x={key:1,style:{color:"green"}},C=r((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"check_circle",-1))),U={key:0,class:"help-block"},P={key:0,style:{color:"red"}},Z={key:3,class:"form-group"},H=r((()=>(0,i._)("label",{class:"form-label",for:"customFile"}," اضافة اقتباس",-1))),W={key:0,class:"help-block"},j={key:0,style:{color:"red"}},R=r((()=>(0,i._)("hr",null,null,-1))),z={key:4,class:"text-danger text-center"},N={key:5,class:"text-danger text-center"},L={key:6,class:"col-sm-12 text-center"},V=["src"],Y=["disabled"];function K(e,s,r,c,K,G){const J=(0,i.up)("ImagePreviewer");return(0,i.wg)(),(0,i.iD)("form",{onSubmit:s[7]||(s[7]=(0,o.iM)(((...e)=>G.submit&&G.submit(...e)),["prevent"]))},[(0,i._)("div",h,[(0,i._)("div",n,[l,(0,i._)("div",d,[(0,i.wy)((0,i._)("select",{class:"form-select w-100",name:"type_of_thesis",id:"type_of_thesis","onUpdate:modelValue":s[0]||(s[0]=e=>c.v$.thesisForm.typeOfThesis.$model=e),onChange:s[1]||(s[1]=e=>G.changeTypeOfThesis(e.target.options[e.target.options.selectedIndex].value))},p,544),[[o.bM,c.v$.thesisForm.typeOfThesis.$model]])])]),K.showPages?((0,i.wg)(),(0,i.iD)("div",m,[(0,i._)("div",g,[(0,i._)("h5",{class:(0,a.C_)(["form-label",{"text-primary":0===G.pages.length&&!K.startOver}])},(0,a.zw)(0!==G.pages.length||K.startOver?"الصفحات":"لقد أنهيت الكتاب"),3)])])):(0,i.kq)("",!0),K.showPages?((0,i.wg)(),(0,i.iD)("div",u,[0!==G.pages.length||K.startOver?((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[(0,i._)("div",v,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"start_page",id:"start_page","onUpdate:modelValue":s[3]||(s[3]=e=>c.v$.thesisForm.start_page.$model=e)},[k,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(G.pages,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,a.zw)(e),9,w)))),128))],512),[[o.bM,c.v$.thesisForm.start_page.$model]]),c.v$.thesisForm.start_page.$error?((0,i.wg)(),(0,i.iD)("div",b,[c.v$.thesisForm.start_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",f,"الرجاء اختيار صفحة البداية")):(0,i.kq)("",!0),!c.v$.thesisForm.start_page.required.$invalid&&c.v$.thesisForm.start_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",_,"البداية يجب ان تكون اقل من النهاية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)]),(0,i._)("div",T,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"end_page",id:"end_page","onUpdate:modelValue":s[4]||(s[4]=e=>c.v$.thesisForm.end_page.$model=e)},[F,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(G.pages,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,a.zw)(e),9,$)))),128))],512),[[o.bM,c.v$.thesisForm.end_page.$model]]),c.v$.thesisForm.end_page.$error?((0,i.wg)(),(0,i.iD)("div",D,[c.v$.thesisForm.end_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",O,"الرجاء اختيار صفحة النهاية")):(0,i.kq)("",!0),!c.v$.thesisForm.end_page.required.$invalid&&c.v$.thesisForm.end_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",q,"النهاية يجب ان تكون اكبر من البداية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])],64)):((0,i.wg)(),(0,i.iD)("button",{key:0,class:"btn btn-primary me-2 d-flex align-content-center justify-content-center",onClick:s[2]||(s[2]=(0,o.iM)(((...e)=>G.startBookOver&&G.startBookOver(...e)),["prevent"]))},[y,(0,i.Uk)(" إعادة قراءة الكتاب ")]))])):(0,i.kq)("",!0),K.thesis?((0,i.wg)(),(0,i.iD)("div",S,[E,(0,i.wy)((0,i._)("textarea",{rows:"5",placeholder:"... اكتب أطروحتك",class:"rounded form-control",id:"thesisBody",name:"thesisBody","onUpdate:modelValue":s[5]||(s[5]=e=>c.v$.thesisForm.body.$model=e)},null,512),[[o.nr,c.v$.thesisForm.body.$model,void 0,{trim:!0}]]),(0,i._)("p",M,[(0,i._)("span",null,(0,a.zw)(c.v$.thesisForm.body.$model.length)+"/400 حرف",1),B,c.v$.thesisForm.body.$model.length<400?((0,i.wg)(),(0,i.iD)("span",A,[(0,i.Uk)("أطروحة غير شاملة "),I])):((0,i.wg)(),(0,i.iD)("span",x,[(0,i.Uk)("أطروحة شاملة "),C]))]),c.v$.thesisForm.body.$error?((0,i.wg)(),(0,i.iD)("div",U,[c.v$.thesisForm.body.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",P,"الرجاء ادخال الأطروحة")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),K.screenshots?((0,i.wg)(),(0,i.iD)("div",Z,[H,(0,i._)("input",{class:"form-control",type:"file",id:"customFile",multiple:"",accept:"image/jpeg, image/png, image/jpg, image/gif, image/svg",ref:"screenShots",onChange:s[6]||(s[6]=(...e)=>G.previewImages&&G.previewImages(...e))},null,544),c.v$.thesisForm.screenShots.$error?((0,i.wg)(),(0,i.iD)("div",W,[c.v$.thesisForm.screenShots.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",j,"الرجاء ادخال اقتباس واحد على الاقل")):(0,i.kq)("",!0)])):(0,i.kq)("",!0),K.thesisForm.screenShots.length?((0,i.wg)(),(0,i.j4)(J,{key:1,media:K.thesisForm.screenShots,onRemoveMedia:G.removeImage,ref:"imagePreviewer"},null,8,["media","onRemoveMedia"])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),R,K.errorMessage?((0,i.wg)(),(0,i.iD)("small",z,(0,a.zw)(K.errorMessage),1)):(0,i.kq)("",!0),K.mediaNoteText&&r.thesisToEdit?((0,i.wg)(),(0,i.iD)("small",N,(0,a.zw)(K.mediaNoteText),1)):(0,i.kq)("",!0),K.loader?((0,i.wg)(),(0,i.iD)("div",L,[(0,i._)("img",{src:t(79885),alt:"loader",style:{height:"100px"}},null,8,V)])):(0,i.kq)("",!0),K.loader?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:7,type:"submit",class:"btn btn-primary d-block mt-3",disabled:c.v$.thesisForm.$invalid}," إضافة ",8,Y))])],32)}var G=t(54028),J=t(62587),Q=t(27522),X=t(91130),ee=t(8209),se={name:"CreateThesis",components:{ImagePreviewer:X.Z},props:{book:{type:Object,default:null},lastThesis:{type:Object,default:null},thesisToEdit:{type:Object,default:null}},setup(){return{v$:(0,G.ZP)()}},data(){return{thesis:!1,screenshots:!1,showPages:!1,loader:!1,startOver:!1,thesisForm:{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[],type:"thesis",book_id:null,u_comment_id:null},mediaNoteText:"",errorMessage:""}},computed:{pages(){let e=[],s=null;if(console.log("[computed last thesis]",this.lastThesis),console.log("[computed book]",this.book),this.book.userBooks.length&&"in progress"===this.book.userBooks[0].status?(s=this.lastThesis?this.lastThesis?.end_page+1:this.book.start_page,console.log("[computed in progress]",s)):this.book.userBooks.length||this.lastThesis||(s=this.book.start_page,console.log("[computed first thesis]",s)),this.thesisToEdit&&(s=this.book.start_page,console.log("[computed editting]",s)),null===s&&!this.startOver)return console.log("[computed finished]",s),[];null===s&&this.startOver&&(s=this.book.start_page,console.log("[computed start over]",s));for(let t=s;t<=this.book.end_page;t++)e.push(t);return e},successMessage(){return this.thesisToEdit?"تم تعديل الأطروحة بنجاح":"تم إضافة الأطروحة بنجاح"}},watch:{book(){this.thesisForm.book_id=this.book.id,console.log("[watch book id]",this.thesisForm.book_id)}},created(){if(this.thesisToEdit){console.log("[created thesisToEdit]",this.thesisToEdit),this.thesisForm.u_comment_id=parseInt(this.thesisToEdit.id),this.thesisForm.body=this.thesisToEdit.body?this.thesisToEdit.body:"",this.thesisForm.start_page=this.thesisToEdit.thesis.start_page,this.thesisForm.end_page=this.thesisToEdit.thesis.end_page,this.thesisForm.screenShots.old=this.thesisToEdit.media??[],this.showPages=!0,!this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||!this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0?this.thesisForm.typeOfThesis="read":(this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0)&&(this.thesisForm.typeOfThesis="readAndWrite"),this.changeTypeOfThesis(this.thesisForm.typeOfThesis);const e=this.checkThesisHasMedia(this.thesisToEdit);this.mediaNoteText=e>0?`ملاحظة: سيتم حذف الصور الموجودين بعد تعديل الأطروحة وعددهم: ${e}`:""}else this.thesisForm.book_id=this.book?.id,console.log("[book]",this.book),console.log("[thesisForm created]",this.thesisForm)},methods:{showAddThesis(){this.thesis=!0,this.screenshots=!1},showAddScreenshots(){this.screenshots=!0,this.thesis=!1},noThesisAndScreenshots(){this.thesis=!1,this.screenshots=!1},thesisAndScreenshots(){this.thesis=!0,this.screenshots=!0},changeTypeOfThesis(e){this.showPages=!0,"read"==e?this.noThesisAndScreenshots():"readAndWrite"==e?this.showAddThesis():"screenshots"==e?this.showAddScreenshots():"screenshotsAndWrite"==e?this.thesisAndScreenshots():(this.showPages=!1,this.noThesisAndScreenshots())},previewImages(e){this.thesisForm.screenShots=e.target.files},removeImage(e){const s=[...this.thesisForm.screenShots];s.splice(e,1),this.thesisForm.screenShots=s,0==this.thesisForm.screenShots.length&&(this.$refs.screenShots.value=null)},async submit(){if(this.v$.$touch(),this.v$.thesisForm.$invalid)this.errorMessage="الرجاء ادخال جميع البيانات المطلوبة";else{this.loader=!0;try{let e;if(this.updateThesisForm(),e=this.thesisToEdit?await Q.Z.update(this.thesisForm):await Q.Z.create(this.thesisForm),200!==e.statusCode)throw e.data;ee.Z.handleSuccessSwal(this.successMessage),this.thesisToEdit?setTimeout((()=>{location.reload()}),1800):(this.$emit("addThesis",e.data),this.thesisForm={...this.thesisForm,typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[]},this.v$.thesisForm.$reset(),this.changeTypeOfThesis(""),setTimeout((()=>{this.$emit("closeModel")}),2e3))}catch(e){ee.Z.handleErrorSwal("حدث خطأ ما, يرجى المحاولة مرة أخرى!"),console.log(e)}finally{this.loader=!1}}},updateThesisForm(){"read"==this.thesisForm.typeOfThesis?(this.thesisForm.body=null,this.thesisForm.screenShots=[]):"readAndWrite"==this.thesisForm.typeOfThesis?this.thesisForm.screenShots=[]:"screenshots"==this.thesisForm.typeOfThesis&&(this.thesisForm.body=null)},startBookOver(){this.startOver=!0},checkThesisHasMedia(e){let s=0;return e.media&&s++,e.replies?.length&&e.replies.forEach((e=>{"screenshot"===e.type&&e.media&&s++})),s}},validations(){return{thesisForm:{typeOfThesis:{required:J.C1},start_page:{required:J.C1,between:e=>parseInt(e)<parseInt(this.thesisForm.end_page)},end_page:{required:J.C1,between:e=>parseInt(e)>parseInt(this.thesisForm.start_page)},body:{requiredIf:(0,J.CF)((()=>"readAndWrite"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))},screenShots:{requiredIf:(0,J.CF)((()=>"screenshots"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))}}}}},te=t(83744);const ie=(0,te.Z)(se,[["render",K],["__scopeId","data-v-42061fa3"]]);var oe=ie},91130:function(e,s,t){t.d(s,{Z:function(){return g}});var i=t(66252);const o={class:"preview-images"},a=["onClick"],r=(0,i._)("span",null," x ",-1),h=[r],n=["src"],l=["src"];function d(e,s,t,r,d,c){return(0,i.wg)(),(0,i.iD)("div",o,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(d.previewUrls,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{class:"image-container",key:e.url},[(0,i._)("div",{class:"delete-image",onClick:e=>c.removeMedia(s)},h,8,a),e.type.includes("image")?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.url},null,8,n)):((0,i.wg)(),(0,i.iD)("video",{key:1,src:e.url,autoplay:""},null,8,l))])))),128))])}var c={name:"ImagePreviewer",props:{media:{type:[Array,FileList],default:()=>[]}},emits:["remove-media"],data(){return{previewUrls:[]}},methods:{previewMedia(){this.previewUrls=[];const e=[...this.media];e.forEach((e=>{const s=new FileReader;s.onload=()=>{this.previewUrls.push({url:s.result,type:e.type})},s.readAsDataURL(e)}))},removeMedia(e){this.previewUrls.splice(e,1),this.$emit("remove-media",e)},clearMedia(){this.previewUrls=[]}},mounted(){this.previewMedia()},watch:{media(){this.previewMedia()}}},p=t(83744);const m=(0,p.Z)(c,[["render",d]]);var g=m},21218:function(e,s,t){e.exports=t.p+"img/200x200-book.5a0360f9.png"}}]);
//# sourceMappingURL=5308.43319b34.js.map