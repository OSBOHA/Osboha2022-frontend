"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[9789],{26045:function(e,s,t){var o=t(24150),a=t(66252);class i{async getThesisById(e){try{const s=await o.hi.get(`/theses/${e}`);return s.data.data}catch(s){(0,a.S3)(s)}}async getBookThesis(e,s){try{const t=await o.hi.get(`/theses/book/${e}/thesis/${s}`);return t.data}catch(t){(0,a.S3)(t)}}async getThesesByBookId(e,s,t=""){try{const a=await o.hi.get(`/theses/book/${e}/user/${t}?page=${s}`);return a.data}catch(i){(0,a.S3)(i)}}async getThesisByUser(e,s){try{const t=await o.hi.get(`/theses/user/${e}?page=${s}`);return t.data}catch(t){(0,a.S3)(t)}}async getThesisByWeek(e){try{const s=await o.hi.get(`/theses/week/${e}`);return s.data}catch(s){(0,a.S3)(s)}}}s["Z"]=new i},72808:function(e,s,t){t.r(s),t.d(s,{default:function(){return he}});var o=t(66252),a=t(3577);const i={class:"row"},l={class:"col-lg-12"},d={class:"card card-block card-stretch card-height blog blog-detail"},r={class:"card-body"},n={class:"image-block text-center mt-3"},c=["src"],h={class:"blog-description mt-3 text-center"},m={class:"mb-3 pb-3 border-bottom text-center"},b={class:"blog-meta d-flex align-items-center mb-3 position-right-side flex-wrap"},g={class:"date me-4 d-flex align-items-center"},u=(0,o._)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"},"calendar_month",-1),k={class:"like me-4 d-flex align-items-center"},_=(0,o._)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," star ",-1),f={class:"comments me-4 d-flex align-items-center"},p=(0,o._)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," book ",-1),T={class:"comments me-4 d-flex align-items-center"},y=(0,o._)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," comment ",-1),w={class:"comments me-4 d-flex align-items-center"},v=(0,o._)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," mode_comment ",-1),x={class:"text-center"},B={key:0,class:"col-lg-12"},C=(0,o._)("div",{class:"card card-block card-stretch card-height blog"},[(0,o._)("button",{type:"submit",class:"btn btn-primary d-block w-100","data-bs-toggle":"modal","data-bs-target":"#modals"}," كتابة أطروحة ")],-1),D=[C],$={class:"col-lg-12"},M={class:"card card-block card-stretch card-height blog user-comment"},W=(0,o._)("div",{class:"card-header d-flex justify-content-between"},[(0,o._)("div",{class:"header-title"},[(0,o._)("h4",{class:"card-title"},"الأطروحات")])],-1),Z={class:"card-body"},z={key:0,class:"row"},L={class:"card card-block card-stretch card-height blog"},U={class:"card-body"},q=(0,o._)("h5",{class:"modal-title",id:"modalsLabel"},"تعديل الأطروحة",-1),S=(0,o._)("span",{class:"material-symbols-outlined"},"close",-1),Y=[S],A={key:0,class:"col-sm-12 text-center"},E=["src"],I={class:"col-lg-12"},j={class:"card card-block card-stretch card-height blog"},R=["disabled"],O={key:1,class:"row"},P={class:"col-lg-12"},H={class:"text-center d-flex align-items-center"},K=(0,o._)("span",{class:"material-symbols-outlined"}," comments_disabled ",-1),F={key:0,class:"ms-2"},G={key:1,class:"ms-2"},J={key:0},N={class:"modal-title",id:"modalsLabel"},Q={href:"javascript:void(0);",class:"lh-1","data-bs-dismiss":"modal",ref:"closeBtn"},V=(0,o._)("span",{class:"material-symbols-outlined"},"close",-1),X=[V];function ee(e,s,C,S,V,ee){const se=(0,o.up)("Comment"),te=(0,o.up)("model-header"),oe=(0,o.up)("createThesis"),ae=(0,o.up)("model-body"),ie=(0,o.up)("modal");return(0,o.wg)(),(0,o.iD)("main",null,[(0,o._)("div",i,[(0,o._)("div",l,[(0,o._)("div",d,[(0,o._)("div",r,[(0,o._)("div",n,[(0,o._)("img",{src:ee.resolve_img_url(V.book.book?.media?.path??""),class:"img-fluid rounded w-25",alt:"blog-img"},null,8,c)]),(0,o._)("div",h,[(0,o._)("h2",m,(0,a.zw)(V.book.book?.name),1),(0,o._)("div",b,[(0,o._)("div",g,[u,(0,o.Uk)("تاريخ الاضافة "+(0,a.zw)(ee.formattedDate),1)]),(0,o._)("div",k,[_,(0,o.Uk)(" "+(0,a.zw)(V.book.rate)+"% تقييم ",1)]),(0,o._)("div",f,[p,(0,o.Uk)(" عدد الصفحات: "+(0,a.zw)(V.book.book?.end_page),1)]),(0,o._)("div",T,[y,(0,o.Uk)((0,a.zw)(V.book.theses_count)+" أطروحة ",1)]),(0,o._)("div",w,[v,(0,o.Uk)((0,a.zw)(V.book.comments_count)+" تعليق ",1)])]),(0,o._)("div",x,[(0,o.Uk)((0,a.zw)(V.shortBriefText)+" ",1),ee.isMore?((0,o.wg)(),(0,o.iD)("a",{key:0,class:"load-btn",onClick:s[0]||(s[0]=(...e)=>ee.loadMoreBriefText&&ee.loadMoreBriefText(...e))},"...قراءة المزيد")):(0,o.kq)("",!0),ee.isLess?((0,o.wg)(),(0,o.iD)("a",{key:1,class:"load-btn",onClick:s[1]||(s[1]=(...e)=>ee.loadLessBriefText&&ee.loadLessBriefText(...e))},"قراءة أقل")):(0,o.kq)("",!0)])])])])]),V.book.allow_comments?((0,o.wg)(),(0,o.iD)("div",B,D)):(0,o.kq)("",!0),(0,o._)("div",$,[(0,o._)("div",M,[W,(0,o._)("div",Z,[V.theses.length?((0,o.wg)(),(0,o.iD)("div",z,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(V.theses,(e=>((0,o.wg)(),(0,o.iD)("div",{class:"col-lg-12",key:e.id},[(0,o._)("div",L,[(0,o._)("div",U,[(0,o.Wm)(se,{allowComment:V.book.allow_comments,comment:e,totalThesisPages:e.thesis&&e.thesis.end_page-e.thesis.start_page>0?e.thesis.end_page-e.thesis.start_page+1:0,onAddComment:ee.addComment,onEditComment:ee.editComment,onReactToComment:ee.reactToComment},null,8,["allowComment","comment","totalThesisPages","onAddComment","onEditComment","onReactToComment"])])]),(0,o.Wm)(ie,{id:`editThesis-${e.id}`,ref_for:!0,ref:"editThesisRef",dialogClass:"modal-dialog-centered modal-dialog-scrollable",tabindex:"-1","aria-labelledby":"editThesis","aria-hidden":!1},{default:(0,o.w5)((()=>[(0,o.Wm)(te,null,{default:(0,o.w5)((()=>[q,(0,o._)("a",{href:"javascript:void(0);",class:"lh-1","data-bs-dismiss":"modal",ref_for:!0,ref:"editCloseBtn"},Y,512)])),_:1}),(0,o.Wm)(ae,null,{default:(0,o.w5)((()=>[(0,o.Wm)(oe,{book:V.book.book,thesisToEdit:e},null,8,["book","thesisToEdit"])])),_:2},1024)])),_:2},1032,["id"])])))),128)),V.loading?((0,o.wg)(),(0,o.iD)("div",A,[(0,o._)("img",{src:t(79885),alt:"loader",style:{height:"100px"}},null,8,E)])):(0,o.kq)("",!0),(0,o._)("div",I,[(0,o._)("div",j,[ee.hasMoreTheses?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-primary d-block w-100",onClick:s[2]||(s[2]=(...e)=>ee.loadMoreTheses&&ee.loadMoreTheses(...e)),disabled:V.loading}," تحميل المزيد ",8,R)):(0,o.kq)("",!0)])])])):((0,o.wg)(),(0,o.iD)("div",O,[(0,o._)("div",P,[(0,o._)("div",H,[K,e.$route.params.thesis_id?((0,o.wg)(),(0,o.iD)("h5",F," لم يتم العثور على هذه الأطروحة ")):((0,o.wg)(),(0,o.iD)("h5",G,[(0,o.Uk)(" لا يوجد أطروحات "),e.$route.params.user_id?((0,o.wg)(),(0,o.iD)("span",J,"لهذا السفير")):(0,o.kq)("",!0)]))])])]))])])])]),(0,o.Wm)(ie,{id:"modals",ref:"modals",dialogClass:"modal-dialog-centered modal-dialog-scrollable",tabindex:"-1","aria-labelledby":"modalsLabel","aria-hidden":!1},{default:(0,o.w5)((()=>[(0,o.Wm)(te,null,{default:(0,o.w5)((()=>[(0,o._)("h5",N,(0,a.zw)(V.book.book?.name)+" || أطروحة جديدة ",1),(0,o._)("a",Q,X,512)])),_:1}),(0,o.Wm)(ae,null,{default:(0,o.w5)((()=>[(0,o.Wm)(oe,{book:V.book.book,lastThesis:V.book.last_thesis,onCloseModel:ee.closeModel,onAddThesis:ee.addThesis},null,8,["book","lastThesis","onCloseModel","onAddThesis"])])),_:1})])),_:1},512)])}var se=t(20117),te=(t(96648),t(76614)),oe=t(34964),ae=t(26045),ie=t(30381),le=t.n(ie),de=t(8209),re={name:"BookDetails",components:{Comment:se.Z,createThesis:te.Z},provide(){return{deleteComment:this.deleteComment}},async created(){await this.getBook(this.$route.params.book_id),await this.getTheses(this.page),console.log("bookDetails - book",this.book)},data(){return{theses:[],book:{},fullBriefText:"",shortBriefText:"",page:1,totalTheses:0,loading:!1}},methods:{async getBook(e){try{const s=await oe.Z.getById(e);200===s.statusCode?(this.book=s.data,this.fullBriefText=this.book.book?.brief,this.shortBriefText=this.fullBriefText?.slice(0,200)):console.log("error: ",s.data)}catch(s){console.log(s)}},loadMoreBriefText(){this.shortBriefText=this.fullBriefText},loadLessBriefText(){this.shortBriefText=this.fullBriefText?.slice(0,200)},resolve_img_url:function(e){return e||t(21218)},async getTheses(e){if(!this.loading){this.loading=!0;try{let s;s=this.$route.params.thesis_id?await ae.Z.getBookThesis(this.$route.params.book_id,this.$route.params.thesis_id):await ae.Z.getThesesByBookId(this.$route.params.book_id,e,this.$route.params.user_id??""),200===s.statusCode?(this.theses.push(...s.data.theses),this.totalTheses=s.data.total):de.Z.toggleToast("حدث خطأ أثناء تحميل البيانات, الرجاء المحاولة مرة أخرى","error")}catch(s){de.Z.toggleToast("حدث خطأ أثناء تحميل البيانات, الرجاء المحاولة مرة أخرى","error")}finally{this.loading=!1}}},async loadMoreTheses(){this.page++,await this.getTheses(this.page)},async closeModel(){this.$refs.closeBtn.click()},addThesis(e){this.theses.unshift(e),this.book.theses_count++,this.book.comments_count=this.book.comments_count+e.replies.length+1,this.totalTheses++,this.book.book.userBooks=e.user.userBooks,this.book.last_thesis=e.thesis,this.book.book.userBooks.length>0&&"finished"===this.book.book.userBooks[0].status&&de.Z.toggleToast("تهانينا, لقد أنهيت الكتاب","success")},findComment(e,s){for(let t=0;t<e.length;t++){if(e[t].id===s)return e[t];if(e[t].replies.length>0){const o=this.findComment(e[t].replies,s);if(o)return o}}},addComment(e,s){if(!s)return this.theses.push(e),this.book.comments_count++,void this.totalTheses++;{const t=this.findComment(this.theses,s);t.replies.push(e),this.book.comments_count++,console.log("[added comment at book]",t)}},deleteComment(e){for(let s=0;s<this.theses.length;s++){if(this.theses[s].id===e)return this.theses.splice(s,1),this.book.comments_count--,void this.totalTheses--;if(this.theses[s].replies.length>0)for(let t=0;t<this.theses[s].replies.length;t++)if(this.theses[s].replies[t].id===e)return this.theses[s].replies.splice(t,1),void this.book.comments_count--}},editComment(e){let s=this.findComment(this.theses,e.id);s.body=e.body,s.media=e.media},reactToComment(e,s){let t=this.findComment(this.theses,e);s?(t.reactions_count++,t.reacted_by_user=!0):(t.reactions_count--,t.reacted_by_user=!1)}},computed:{formattedDate(){return le()(this.book?.created_at).format("YYYY-MM-DD")},isMore(){return this.shortBriefText?.length<this.fullBriefText?.length},isLess(){return this.shortBriefText?.length>=this.fullBriefText?.length&&this.fullBriefText?.length>200},hasMoreTheses(){return this.theses.length<this.totalTheses&&this.totalTheses>0&&this.theses.length>0}}},ne=t(83744);const ce=(0,ne.Z)(re,[["render",ee]]);var he=ce}}]);
//# sourceMappingURL=9789.d609553d.js.map